<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="encoding" content="utf-8">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <link rel="stylesheet" href="styles/index.css">
</head>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap');
*, ::after, ::before {
    box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
  font-family: 'Roboto', sans-serif;
  font-size: 14px;
  line-height: 1.4;
  width: 100%;
  min-height: 100vh;
  color: #4C4C4C;
  position: relative;
  background-color: #fff;
}

#diagnose {
  opacity: 1;
  transform: translateX(100vw);
}

.container {
  width: 100%;
  max-width: 1024px;
  margin-left: auto;
  margin-right: auto;
  overflow: hidden;
}

.hide { display: none!important; visibility: hidden;width: 0; height: 0;}

.not-allow {
  pointer-events: none;
}

.text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.text-black {
  color: #000
}

.w-100 {
  width: 100%;
}

.mt-5 {
  margin-top: 5px!important;
}

.mt-15 {
  margin-top: 15px;
}

.mb-0 {
  margin-bottom: 0px!important;
}

.mb-15 {
  margin-bottom: 15px;
}

.mt-20px {
  margin-top: 20px;
}

.mr-7px  {
  margin-right: 7px;
}

.p-15 {
  padding: 15px;
}
.fs-14 {
  font-size: 14px!important;
}
.fs-16 {
  font-size: 16px;
}
.fs-20 {
  font-size: 20px;
}

.f-bold {
  font-weight: bold;
}

.main-container {
  position: relative;
}

.header-top {
  height: 48px;
}

.header-label {
  font-size: 16px;
  background-color: #CEEED8;
  color: #424040;
  text-align: center;
  padding: 7px 15px;
  height: 37px;
}

.header-title {
  margin-top: 15px;
  padding: 7px 15px;
  font-size: 18px;
  font-weight: bold;
  text-align: center;
}

.header-title span {
  display: block;
  color: #252525;
}

.banner  {
  margin-top: 15px;
}

.banner img {
  max-width: 100%;
}

.btn {
  display: inline-block;
  border-radius: 5px;
  text-align: center;
  line-height: initial;
  font-size: 16px;
  border: none;
  box-shadow: 0 4px 6px rgb(0 0 0 / 35%);
  padding: 6px 15px;
  position: relative;
}

.btn::before {
  content: '';
  position: absolute;
  left: 0;
  top:0;
  right: 0;
  bottom: 0;
  z-index: 1;
}

.inner-btn {
  display: flex;
  justify-content: center;
  align-items: center;
}

.btn--primary {
  /* background-color: #49A3E5; */
  background-color: #2E75B4;
  color: #EDEDED;
}

.btn--light {
  background-color: #F7F7F7;
  border: 1px solid #CEEED8;
}

.btn--success {
  background-color: #CEEED8;
}

.btn--error {
  background-color: #ea4025;
  color: #fff;
}

.btn--warning {
  background-color: #F09A37;
  color: #fff;
}

.btn--blue {
  background-color: #5DC1C9;
  color: #fff;
}

.btn--blue1 {
  background-color: #339AC3;
  color: #fff;
}

.btn--pink {
  background-color: #F787BF;
  color: #fff;
}

.btn--large {
  padding: 9px 15px;
}

.fixed-footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 10;
  background-color: #fff;
}

.btn-start {
  font-size: 20px;
  padding: 10px 20px;
  max-width: 500px;
}

.group-btn .btn {
  margin: 0 18px;
  color: #4C4C4C;
}

.btn-top {
  height: 48px;
  width: 48px;
  display: inline-block;
}

.btn-open {
  padding: 11px 7px;
}

.qs-item__top {
  padding: 30px 0;
}

.qs-number {
  width: 75px;
  height: 75px;
  border: 3px solid #A6DAB6;
  border-radius: 50%;
  font-size: 48px;
  color: #A6DAB6;
  line-height: 54px;
  text-align: center;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-left: auto;
  margin-right: auto;
}

.qs-item__body {
  padding: 0 15px;
}
.qs-question {
  font-weight: bold;
  font-size: 16px;
  text-align: center;
}
.qs-answer,
.qs-progress {
  padding: 15px;
}

.qs-answer__option {
  position: relative;
  margin-bottom: 15px;
}

.qs-answer__option.disabled {
  opacity: .8;
}

[type="radio"]:checked, [type="radio"]:not(:checked) {
  position: absolute;
  left: -9999px;
}

.qs-answer-item {
  position: relative;
  display: block;
  padding: 10px 20px;
  border: 1px solid #49A3E5;
  background-color: #FFFFFF;
  margin-bottom: 5px;
  border-radius: 7px;
  color: #49A3E5;
}

[type="radio"]:checked + label {
  background-color: #C1E2FC;
}

.qs-progress {
  position: relative;
}

.progress-bar-text {
  font-weight: bold;
  position: absolute;
  top: 0px
}

.progress-bar-text.left {
  left: 15px;
}

.progress-bar-text.right {
  right: 15px;
}

.progress-bar {
  margin-top: 10px;
  height: 10px;
  width: 100%;
  background-color : #E5E5E5
}

.progress-bar__inner {
  background-color: #A6DAB6;
  height: 100%;
  width: 0%;
  transition: width 800ms;
}

.result-content {
  font-size: 14px;
  color: #252525;
  padding: 15px 0;
}

.result-content__img{
  max-width: 150px;
}

.tite-cate {
  font-weight: bold;
  font-size: 16px;
}

.content-item {
  padding: 5px 15px;
}

.content-item img {
  max-width: 80%;
}

.content-label  {
  text-align: center;
  font-weight: bold;
  padding: 20px;
  margin-bottom: 20px;
  font-size: 16px;
}

.content-label.blue {
  background-color: #DCF0FF;
  color: #0286E7;
}
.content-label.yellow {
  background-color: #FFF5C4;
  color: #FA8600;
}
.content-label.success {
  background-color: #E7FBED;
  color: #149B15;
}
.content-label.fs-small {
  font-size: 14px;
}
.result-button button {
  min-width: 262px;
}

.comment-item {
  display: flex;
  align-items: center;
  padding: 5px 15px;
}
.comment-item .comment__image {
  width: 100px;
}
.comment-item .comment__text {
  width: calc(100% - 100px);
  background-color: #E7FBED;
  padding: 15px 10px;
  border-radius: 25px;
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 0 15px;
  z-index: 1060;
  width: 100%;
  height: 100%;
  overflow-x: hidden;
  overflow-y: auto;
  outline: 0;
  opacity: 0;
  transform: translateY(100vh);
  transition: all .5s;
}

.modal-dialog {
  max-width: 350px;
  margin: 165px auto auto;
  position: relative;
  width: auto;
  background-color: #FAFAFA;
  box-shadow: 0 4px 6px rgb(0 0 0 / 35%);
  border-radius: 15px;
}

.modal-body, .modal-footer {
  padding: 20px 15px;
}

.fadeinBottom {
  opacity: 1;
  transform: translateY(0);
  -webkit-transform: translateY(0);
  -o-transform: translateY(0);
  -moz-transform: translateY(0);
}

.anreer-anchor, 
.enneagram {
  display: flex;
  flex-direction: column;
}

.anreer-anchor {
  flex-direction: column-reverse !important;
}

</style>
<body>
  <script type="text/javascript">
   (function (){
  window.resultPage = function(){}
  resultPage.prototype.init = function(response) {
    console.log(response)
    this.response = response;
    this.data = this.response.data;
    this.baseUrl = 'https://' + location.host;
    this.imgDefault = '/assets/banner_image.png';
    this.firstResult = this.response.first_result;
    console.log(typeof this.firstResult)
    if (this.data) {
      this.createUI();
    }
  }

  resultPage.prototype.isEmptyObject = (obj) => {
    return Object.keys(obj).length === 0;
  };

  resultPage.prototype.createComponent = function(tag, className, textContent, attributes = {}) {
    const element = document.createElement(tag);
    element.className = className || "";
    element.innerHTML = textContent || "";
  
    for (const [key, value] of Object.entries(attributes)) {
      element.setAttribute(key, value);
    }
  
    return element;
  }

  resultPage.prototype.createUI = function () {
    const body = document.body;
    body.innerHTML = ""; 
    const container = document.createElement("div");
    container.className ="container";

    container.prepend(this.ComponentHeader(), this.ComponentMain())
    body.prepend(container);

    window.scrollTo(0, 0);
  }

  /**
   * create component Header
   * @returns HTML
   */
  resultPage.prototype.ComponentHeader = function() { 
    const elHeader = this.createComponent("header", "header-container", "", {});
    const elHeaderTop = this.createComponent("div", "header-top", "", {});
    const elHeaderLabel = this.createComponent("div", "header-label text-truncate", "診断結果", {});
    
    const elBtnBackTop = this.createComponent("div", "btn-top", "", {});
    elBtnBackTop.appendChild(this.createComponent("img", "", "", { src : 'https://www.test-lac.learningpocket.com/assets/images/ic_arrow_back.png'}));
    elBtnBackTop.addEventListener('click', () => {
      this.evtReviousResult();
    });

    if (!this.firstResult) {
      elHeaderTop.appendChild(elBtnBackTop);
    }
    
    elHeader.prepend(elHeaderTop, elHeaderLabel)
    return elHeader;
  };

  resultPage.prototype.ComponentMain = function() { 
    const { title } = this.data;

    const elMain = this.createComponent("section", "main-container");
    const elTitle =  this.createComponent("div", "header-title text-center text-truncate", "", {});
    const elTextTitle = this.createComponent("span", "fs-16", "あなたは");
    const elTextType = this.createComponent("span", "fs-20", title, {}); 

    elTitle.prepend(elTextTitle, elTextType)

    elMain.prepend(elTitle, this.ComponentContent(), this.LayoutGroupButton());
    
    return elMain;
  }

  resultPage.prototype.ComponentContent = function() { 
    const { img, detail_top, detail_bot, customer_comment, doc_rc, user_type } = this.data;
    console.log(this.isEmptyObject(doc_rc))
    const elContent = this.createComponent("div", "result-content", "", {});

    if (this.data.hasOwnProperty('img') && (img ||'') !== null) {
      elContent.appendChild(this.LayoutTopResult(img))
    }

    if (this.data.hasOwnProperty('detail_top')  && detail_top.length > 0) {
      elContent.appendChild(this.LayoutContent(detail_top))
    }

    if (this.data.hasOwnProperty('detail_bot')  && detail_bot.length > 0) {
      elContent.appendChild(this.LayoutContent(detail_bot, false))
    }

    if(this.data.hasOwnProperty('customer_comment') && customer_comment.length > 0) {
      elContent.appendChild(this.LayoutCustomerComment(customer_comment));
    }

    if(this.data.hasOwnProperty('doc_rc') && !this.isEmptyObject(doc_rc)) {
      elContent.appendChild(this.LayoutSupportContent(doc_rc))
    }

    elContent.appendChild(this.LayoutContentBottom(user_type));

    return elContent;
  }

  resultPage.prototype.LayoutTopResult = function(img) {
    const elDivImage = this.createComponent("div", "text-center");
    const elImage = this.createComponent("img", "result-content__img", "", {
      src: img,
    });

    // const eLTopDesc = this.createComponent("div", "", );
    elDivImage.appendChild(elImage);
    return elDivImage;
  };

  resultPage.prototype.loadImage = function(item, defaultSrc, successCallback, errorCallback, eventHandlers = []) {
    const img = new Image();
    let errorOccurred = false;

    img.onload = function() {
      if (typeof successCallback === 'function') {
        successCallback(img);
      }
    };

    img.onerror = function() {
      if (!errorOccurred) {
        errorOccurred = true;
        img.src = defaultSrc;
        img.onerror = null;
        if (typeof errorCallback === 'function') {
          errorCallback(img);
        }
      }
    };

    img.setAttribute('alt', '');
    img.setAttribute('data_next', item.next_result ?? '');

    if (eventHandlers.length > 0) {
      eventHandlers.forEach(eventHandler => {
          const { eventName, handler } = eventHandler;
          img.addEventListener(eventName, handler);
      });
    }

    if (item.img && item.img.length > 0) {
      img.src = item.img;
    } else {
      img.src = defaultSrc;
    }

    return img;
  }


  resultPage.prototype.LayoutContent = function(contents, isDetailTop = true) {
    const elBlockContent = this.createComponent("div", "mt-15", "" , {});
    for (const item of contents) {
      const elItemContent = this.createComponent("div", "content-item", "");
      const elTitle = this.createComponent("div", "tite-cate mb-15 mt-15", item.title, isDetailTop ? {} : { data_next: item.next_result });

      
      let elImage = '';
      elImage = this.createComponent("div", "text-center mb-15");
      this.loadImage(
        item,
        this.imgDefault,
        function(successImg) {
          elImage.appendChild(successImg);
        },
        function(errorImg) {
          elImage.appendChild(errorImg);
        },
        [
          {
            eventName: 'click',
            handler: function(e) { 
              const nextId = e.target.getAttribute("data_next");
              if (nextId != "") {
                this.evtNextResult(nextId)
              }
            }.bind(this)
          }
        ]
      );
      

      let elDesc = '';
      if (item.detail.length > 0) {
        elDesc = this.createComponent("div", "", item.detail, {});
      }
     
      elItemContent.appendChild(elTitle);
      if (elImage && !isDetailTop) {
        elItemContent.appendChild(elImage);
      }
      if (elDesc) {
        elItemContent.appendChild(elDesc);
      }
      elBlockContent.appendChild(elItemContent)
    }
   
    return elBlockContent;
  };

  resultPage.prototype.LayoutCustomerComment = function (data) {
    const elBlockComment = this.createComponent("div", "mb-15");
    const elTitle = this.createComponent("div", "content-label fs-14 mb-0 light", "もし道に迷ったら</br>キャリアカウンセリングを受講しませんか？", {});
    const elBlockButton = this.createComponent("div", "text-center", "", {});
    const elLabel = this.createComponent("div", "content-label fs-14 mt-15 success", "キャリアコンサルティング<br>受講者の声", {});
    
    elBlockButton.appendChild(this.ComponentButton({
      text:'キャリアコンサルティング申し込み', 
      isClass: 'btn--large btn--warning', 
      pressHandler: this.evtBackCounsutingPage.bind(this)
    }));

    const elListComment = this.createComponent("div", "");

    for(const item of data) {
      const elCommentItem = this.createComponent('div', "comment-item", "", {});
      const elBlockImage = this.createComponent('div', 'comment__image', '',  {});
      const elImage = this.createComponent('img', '', '', {src: item.img, alt: 'Image' });
      const elText = this.createComponent('div', 'comment__text', item.text, {});

      elBlockImage.appendChild(elImage);
      elCommentItem.prepend(elBlockImage, elText);

      elListComment.appendChild(elCommentItem)
    }
    
    elBlockComment.append(elTitle, elBlockButton, elLabel, elListComment);
    return elBlockComment;
  };

  resultPage.prototype.LayoutSupportContent = function(data) {
    const elBlockContent = this.createComponent("div");
    const elItemContent = this.createComponent("div", "content-item", "", {});

    const elBlockImage = this.createComponent("div", "text-center mb-15", "", {});
    const elImage = this.createComponent("img", "", "", {
      doc_id: data.doc_id,
      doc_code: data.doc_code,
      doc_title: data.doc_title,
      doc_type: data.doc_type,
      src: data.doc_thumb
    });

    const elBlockBtn = this.createComponent("div", "result-button text-center mb-15");
    const elBtn = this.createComponent("button", "btn btn--large btn--error", "この教材を見る", {
      doc_id: data.doc_id,
      doc_code: data.doc_code,
      doc_title: data.doc_title,
      doc_type: data.doc_type,
    });
    elBlockBtn.appendChild(elBtn);

    const elText = this.createComponent("p", "", data.memo);

    elImage.addEventListener("click", this.evtToMaterials.bind(this));
    elBtn.addEventListener("click", this.evtToMaterials.bind(this));

    elBlockImage.appendChild(elImage);
    elItemContent.append(elBlockImage, elBlockBtn, elText);
    elBlockContent.appendChild(this.createComponent("div", "content-label blue", "あなたのステップアップを</br>＼サポートするコンテンツをチェック！／", {}));
    elBlockContent.appendChild(elItemContent);

    return elBlockContent;
  }

  resultPage.prototype.LayoutContentBottom = function (userType) {
    const elBlockBottom = this.createComponent("div", "", "", {});
    const elLabel = this.createComponent("div", "content-label yellow fs-14", "あなたにマッチしそうな</br>お仕事を見てみませんか？", {});
    
    const link_job = (userType || '').toUpperCase() === 'STAFF'
      ? 'https://www.022022.net/sp/?vos=pocket_check01'
      : 'https://www.staffservice.co.jp/?vos=pocket_check3';

    const elBlockBtnLoginService = this.createComponent("div", "text-center result-button mb-15","", {});
    elBlockBtnLoginService.appendChild(
      this.ComponentButton({
        text: "スタッフサービスに派遣登録する",
        icon: this.baseUrl + '/assets/images/icon_edit.png',
        isClass: "btn--large btn--blue",
        data_link: "https://www.022022.net/service/sp/sc11040?vos=pocket_check4",
        pressHandler: this.evtToLinkBrowser.bind(this)
      })
    );

    const elBlockBtnJobSearch = this.createComponent("div", "text-center result-button mb-15","", {});
    elBlockBtnJobSearch.appendChild(
      this.ComponentButton({ 
        text: "お仕事検索はこちら",
        icon: this.baseUrl + '/assets/images/icon_search.png',
        isClass: "btn--large btn--blue1",
        data_link: link_job,
        pressHandler: this.evtToLinkBrowser.bind(this)
      })
    );

    const elBlockBtnLoginMyPage = this.createComponent("div", "text-center result-button mb-15","", {});
    elBlockBtnLoginMyPage.appendChild(this.ComponentButton({
      text: "マイページにログイン",
      icon: this.baseUrl + '/assets/images/icon_lock.png',
      isClass: "btn--large btn--pink",
      data_link: "https://mypage.022022.net/user/sp/sa09020?vos=pocket_check2",
      pressHandler: this.evtToLinkBrowser.bind(this)
    }),
    );

    switch((userType ||'').toUpperCase()) { 
      case "STAFF": 
        elBlockBottom.prepend(elBlockBtnJobSearch, elBlockBtnLoginMyPage);
        break;
      case "GUEST":
        elBlockBottom.prepend(elBlockBtnLoginService, elBlockBtnJobSearch);
        break;
    };
    elBlockBottom.prepend(elLabel);

    return elBlockBottom;
  };

  resultPage.prototype.LayoutGroupButton = function() { 
    const elLabel = this.createComponent("div", "content-label fs-14 mb-0 light", "＼もう一度診断したい方はこちら！！／", {})
    const elGroupButton = this.createComponent("div", "result-content", "", {});

    const elBlockBackStartDiagnose = this.createComponent("div", "text-center result-button mt-20px", "" , {});
    const elBlockBackHome = this.createComponent("div", "text-center result-button mt-20px", "" , {});


    


    elBlockBackStartDiagnose.appendChild(this.ComponentButton({
      text: "もう一度診断する", 
      isClass: "btn--large btn--primary", 
      pressHandler: this.evtBackStartPage.bind(this)
    }));

    elBlockBackHome.appendChild(this.ComponentButton({
      text: "ホームへ戻る",
      isClass:"btn--large text-black",
      pressHandler: this.evtBackHomePage.bind(this)
    }));

    elGroupButton.appendChild(elLabel);
    elGroupButton.appendChild(elBlockBackStartDiagnose);
    elGroupButton.appendChild(elBlockBackHome);
    //elGroupButton.prepend(elLabel, elPreviousResults, elBlockBackStartDiagnose, elBlockBackHome);
    return elGroupButton;
  }


  resultPage.prototype.ComponentButton = function({ text = '', isClass = '', data_link = '', icon= '', pressHandler }) {
    const elButton = this.createComponent("button", `btn ${isClass}`, '', { data_link: data_link });
    const elInnerButton = this.createComponent("div", "inner-btn", "", {});

    if(icon !== '') {
      const elIcon  = this.createComponent('img', '', '', {
        src: icon,
        alt: "Image",
        width: 17,
        style: "margin-right: 5px"
      });

      elInnerButton.appendChild(elIcon);
    }

    if (text !== '') { 
      const elText = this.createComponent("span","" , text, {});
      elInnerButton.appendChild(elText);
    }

    elButton.appendChild(elInnerButton);
    elButton.addEventListener("click", pressHandler);

    return elButton;
  };

  resultPage.prototype.evtBackStartPage = function () {
    this.postMessage('backPage', { "value":"start_diagnose" })
  }

  resultPage.prototype.evtReviousResult = function () {
    console.log('ok')
    this.postMessage('backPage', { "value":"prev_result" })
  }

  resultPage.prototype.evtBackHomePage = function () {
    this.postMessage('backPage', { "value": "home" })
  }

  resultPage.prototype.evtNextResult = function (id) {
    console.log(id)
    this.postMessage('toResult', { "value": id })
  }

  resultPage.prototype.evtBackCounsutingPage = function() {
    this.postMessage('backPage', { "value": "booking_counsuting" })
  }

  resultPage.prototype.evtToMaterials = function (e) {
    this.postMessage('toDetails', { "id": e.target.getAttribute("doc_id") })
  }

  resultPage.prototype.evtToLinkBrowser = function (e) {
    this.postMessage('toLinkBrowser', { "value": e.target.getAttribute("data_link") })
  }

  resultPage.prototype.postMessage = function(fncName, msg){
		msg = JSON.stringify(msg);
		
		if( 'webkit' in window ){
			window.webkit.messageHandlers[fncName].postMessage(msg);
		}else if('android' in window ) {
			(window.android || window.Android)[fncName](msg);
		}
	}

  resultPage.prototype.evtResetResult = function () {
    this.response = null;
    this.data = null;
    document.body.innerHTML = "";
    this.postMessage('resetDataFininshed', { "success": true })
  }

  var result = new resultPage();
  window.isResult = function(data) {
    var e = null, isSuccess = false;
    try { 
      result.init(data)
      isSuccess = true;
    }catch (error){
      e = error.message;
    }
    result.postMessage('loadFinished', {error: e, "success": isSuccess});
    return isSuccess;
  }
  result.postMessage('javascriptLoaded', {"success": true});

  window.resetData = function() {
    result.evtResetResult()
  }
})();
  </script>
</body>